---
format:
  revealjs:
    incremental: false
    css: styles.css
execute: 
  echo: true
---

# The Unix Shell

[SWC @ University of Twente (Online)](https://4turesearchdata-carpentries.github.io/2024-05-27-tudelft-online/)

2024-05-27

Joel H. Nitta

<https://joelnitta.github.io/2024-05-27-tudelft-online-bash>

# [Set up](https://swcarpentry.github.io/shell-novice/index.html)

## Example data

- Download [shell-lesson-data.zip](https://swcarpentry.github.io/shell-novice/data/shell-lesson-data.zip) and move the file to your Desktop.

- Unzip/extract the file. **You should end up with a new folder called shell-lesson-data on your Desktop.**

## Open a new shell

For instructions by operating system, see the [Shell Lesson](https://swcarpentry.github.io/shell-novice/#where-to-type-commands-how-to-open-a-new-shell)

# [Introducing the shell](https://swcarpentry.github.io/shell-novice/01-intro.html)

## Human-computer interaction

- Humans interact with computers using **GUI** (graphical user interface) or **CLI** (command-line interface).

- **GUI**: Intuitive, menu-driven, but not efficient for repetitive tasks.

- **CLI** (Unix shell): Efficient for repetitive tasks, automates tasks quickly.

## The Shell

- The shell **interprets** and **runs** the commands typed by the user.

- Popular Unix shell: **Bash** (**B**ourne **A**gain **SH**ell).

- Benefits of using the shell:
  - Automates repetitive tasks
  - Efficient data handling with powerful pipelines
  - Essential for remote machine interaction and high-performance computing

---

- Today we will learn how to interact with the shell via **commands**

## Shell interface

When you open the shell, you should see something like this:

```
$
```

## Shell interface

- The `$` is the **prompt**, where you type your commands

- Depending on your setup, it may look a little different, for example:

```
nelle@localhost $
```

## `ls`

The first command we will learn is `ls`, which **lists** the content of your current directory (we will come back to this later):

```bash
ls
```

```
Desktop     Downloads   Movies      Pictures
Documents   Library     Music       Public
```

## Nelle's Pipeline

- The example dataset is based on a story about "Nelle Nemo"
  - Context: Nelle Nemo is a marine biologist who samples marine life.
  - Nelle's Goal: Process 1520 samples with `goostats.sh` to measure protein abundance.

Using a GUI, Nelle would need to manually run 1520 files, taking over 12 hours. **Can Nelle do this more efficiently with the shell?**

# [Navigating files and folders](https://swcarpentry.github.io/shell-novice/02-filedir.html)

## Questions

- How can I move around on my computer?

- How can I see what files and directories I have?

- How can I specify the location of a file or directory on my computer?

## What is a File System?

- **File System**: Manages files and directories.
  - **Files**: Hold information (data).
  - **Directories** (= Folders): Hold files or other directories.

## Where are we?

Use `pwd` to show your current working directory (where you "are" in your computer)


---

![](https://swcarpentry.github.io/shell-novice/fig/filesystem.svg)

## Slashes

- There are two meanings for the `/` character.
  - When it appears at the front of a file or directory name, it refers to the **root directory**.
  - When it appears inside a path, it’s just a **separator**.

---

![](https://swcarpentry.github.io/shell-novice/fig/home-directories.svg)

For example, Nelle's files are stored in `/Users/nelle.`

## List files with `ls`

- Use the `-F` **option** to adjust the output:
  - a trailing `/` indicates that this is a directory
  - `@` indicates a link
  - `*` indicates an executable

```bash
ls -F
```

## Clear the terminal

You can clear a cluttered terminal with `clear`

## Help

Get a help menu by adding `--help`:

```bash
ls --help
```

## Help

Or, add `man` in front of the command:

```bash
man ls
```

## Challenge: `ls` {.smaller}

![](https://swcarpentry.github.io/shell-novice/fig/filesystem-challenge.svg){height=250px}

If `pwd` displays `/Users/backup`, and `-r` tells `ls` to display things in reverse order, **what command(s) will result in the following output:**

```
pnas_sub/ pnas_final/ original/
```

1. `ls pwd`
1. `ls -r -F`
1. `ls -r -F /Users/backup`

## Exploring other directories

```bash
ls -F Desktop
```

## Move into other directories with `cd`

```bash
cd Desktop
cd shell-lesson-data
cd exercise-data
```

## Shortcuts for moving: `..`

`..` takes you one directory higher

```bash
cd ..
```

## Shortcuts for moving: `..`

Note that if you use `ls -a` to show everything, you will see `..`

## Shortcuts for moving: `~`

You can use `~` to move to your **home directory**

## Shortcuts for moving: `-`

You can use `-` to move back to the directory you just came from

## Absolute vs. relative paths

If you type a path that does not start with `/`, it means you are talking about a folder or file **relative to your current location**

If you type a path that starts with `/`, it means you are talking about a path **from the root of the file system**

---

## Challenge: relative paths {.smaller}

![](https://swcarpentry.github.io/shell-novice/fig/filesystem-challenge.svg){height=250px}


If `pwd` displays `/Users/thing`, **what will `ls -F ../backup` display?**

1. `../backup: No such file or directory`
1. `2012-12-01 2013-01-08 2013-01-27`
1. `2012-12-01/ 2013-01-08/ 2013-01-27/`
1. `original/ pnas_final/ pnas_sub/`

## General Syntax of a Shell Command

![](https://swcarpentry.github.io/shell-novice/fig/shell_command_syntax.svg)

## General Syntax of a Shell Command

- Options can usually be written in two ways:
  - Long form `--` (`ls --all`)
  - Short form `-` (`ls -a`)
- Spaces matter (`ls-F` means the command "ls-F")
- Capitalization matters (`ls -s` vs `ls -S`)

## Tab completion

The shell will finish typing the names of files and folders for you when you press the tab key

Try it from `~/Desktop/shell-lesson-data/`

```bash
ls north-pacific-gyre/
```

```bash
ls north-pacific-gyre/goo
```

# [Working With Files and Directories](https://swcarpentry.github.io/shell-novice/03-create.html)

## Questions

- How can I create, copy, and delete files and directories?

- How can I edit files?

## Make a new directory with `mkdir`

- Make sure we are in `shell-lesson-data`, then enter `exercise-data/writing`

- Have a look around, then create a new directory called `thesis`:

```bash
mkdir thesis
```

## Make a new directory with `mkdir`

You can create a nested directory using `-p`

```bash
mkdir -p ../project/data ../project/results
```

Check what you did (`-R` is the option to `ls` that will list all nested subdirectories within a directory):

```bash
ls -FR ../project
```

## Best practices: names for files and directories

1. Don’t use spaces.
2. Don’t begin the name with `-` (dash).
3. Stick with letters, numbers, `.` (period or ‘full stop’), `-` (dash) and `_` (underscore).

## Create a text file

`nano` is a text editor program. It will create a file and open it for editing.

```bash
cd thesis
nano draft.txt
```

---

![](https://swcarpentry.github.io/shell-novice/fig/nano-screenshot.png)

Press `Ctrl+o` to save (as indicated by `^0`), then `Ctrl+x` to exit

## Create a text file with `touch`

```bash
touch my_file.txt
```

## Delete a file with `rm`

```bash
rm my_file.txt
```

- `rm` is forever! (no recycle bin). **Be very careful** when you use it.

## Move or rename files and folders with `mv`

Enter `shell-lesson-data/exercise-data/writing`:

```bash
cd ~/Desktop/shell-lesson-data/exercise-data/writing
```

Let's rename `draft.txt`:

```bash
mv thesis/draft.txt thesis/quotes.txt
```

(check the results with `ls`)

## Move or rename files and folders with `mv`

- Like `rm`, there is no "undo" button for `mv`: it will over-write any file with the same name, so **use carefully!**

Let's move `quotes.txt` into our current directory:

```bash
mv thesis/quotes.txt .
```

Check `ls thesis`

## Copy files and folders with `cp`

- `cp` is similar to `mv`, but copies instead of moves

```bash
cp quotes.txt thesis/quotations.txt
ls quotes.txt thesis/quotations.txt
```

## Copy files and folders with `cp`

- Note that you can't just `cp` a folder:

```bash
cp thesis thesis_backup
```

```
cp: thesis is a directory (not copied).
```

## Copy files and folders with `cp`

- To copy a folder and all its contents, use the `-r` (**r**ecursive) option

```bash
cp -r thesis thesis_backup
```

## Delete folders with `rm -r`

- Similar to using `-r` for `cp`, you need `-r` to delete a folder:

```bash
rm -r thesis
```

- Again, **be careful!!**

## Moving, copying, or removing multiple files

- You can move or copy multiple files to a folder by typing all the file names first, then the folder last.
  - Let's test this in `shell-lesson-data/exercise-data`:

```bash
mkdir backup
cp creatures/minotaur.dat creatures/unicorn.dat backup/
```

## Using wildcards for accessing multiple files at once

- Moving multiple files at once is handy, but that was a lot of typing

- We can use `*` and `?` to match multiple file names. These are called "wildcards"

## Using wildcards for accessing multiple files at once

- Consider the files in `shell-lesson-data/exercise-data/alkanes`:

- `*`: Represents zero or more characters.
  - Example: `*.pdb` matches `ethane.pdb`, `propane.pdb`, etc.
  - Example: `p*.pdb` matches `pentane.pdb`, `propane.pdb`.

## Using wildcards for accessing multiple files at once

- `?`: Represents exactly one character.
  - Example: `?ethane.pdb` matches `methane.pdb`.
  - Example: `*ethane.pdb` matches `ethane.pdb`, `methane.pdb`.
  - Example: `???ane.pdb` matches `cubane.pdb`, `ethane.pdb`, `octane.pdb`.

## Wildcard expansion

- Shell expands wildcards to list matching filenames **before running the command**.
- If no match, the wildcard expression is passed as is.
- Example: `ls *.pdf` in a directory with only `.pdb` files results in an error.

## Challenge: List filenames matching a pattern

When run in the `alkanes` directory, which `ls` command(s) will produce this output?

```
ethane.pdb methane.pdb
```

1. `ls *t*ane.pdb`
1. `ls *t?ne.*`
1. `ls *t??ne.pdb`
1. `ls ethane.*`

## Challenge: Organizing {.smaller}

Jamie is working on a project, and she sees that her files aren’t very well organized:

```bash
$ ls -F
analyzed/  fructose.dat    raw/   sucrose.dat
```

The `fructose.dat` and `sucrose.dat` files contain output from her data analysis. **What command(s) covered in this lesson does she need to run so that the commands below will produce the output shown?**

``` bash
$ ls -F
analyzed/   raw/
```

``` bash
$ ls analyzed
fructose.dat    sucrose.dat
```

## Challenge: Reproduce a file structure {.smaller}

You’re starting a new experiment and would like to duplicate the directory structure from your previous experiment so you can add new data.

Assume that the previous experiment is in a folder called `2016-05-18`, which contains a data folder that in turn contains folders named raw and processed that contain data files. The goal is to copy the folder structure of the `2016-05-18` folder into a folder called `2016-05-20` so that your final directory structure looks like this:

```
2016-05-20/
└── data
   ├── processed
   └── raw
```

**Which of the following set of commands would achieve this objective? What would the other commands do?**

[See answer options here](https://swcarpentry.github.io/shell-novice/03-create.html#reproduce-a-folder-structure)

# [Pipes and Filters](https://swcarpentry.github.io/shell-novice/04-pipefilter.html)

## Questions

- How can I combine existing commands to produce a desired output?

- How can I show only part of the output?

## Example: how big are the `pdb` files?

- Nelle needs to determine the `pdb` file **with the fewest lines of text** in the `shell-lesson-data/exercise-data/alkanes` directory.

- She can do this with `wc`, which counts text in a file:

```bash
$ wc cubane.pdb
20  156 1158 cubane.pdb
```

- The output shows number of lines, words, and characters

## Use a wildcard to apply `wc` to all files

Check the number of lines of text in all `.pdb` files:

```bash
wc -l *.pdb
```

This works for a few, but what if we had thousands?

## Save output to a text file

Let's send the results to a file with `>` and read out the contents with `cat`:

```bash
wc -l *.pdb > lengths.txt
cat lengths.txt
```

(note that `>>` will **add to** an existing file)

## Sort the output

Next, use `sort` to sort the output, then save it to a file, then finally get the first entry of that file with `head`:

```bash
sort -n lengths.txt
sort -n lengths.txt > sorted-lengths.txt
head -n 1 sorted-lengths.txt
```

Whew! We did it!

## Challenge: Appending Data {.smaller}

`tail` is similar to `head`, but prints lines from the **end of a file instead**.

Consider the file `shell-lesson-data/exercise-data/animal-counts/animals.csv`. After these commands, select the answer that corresponds to the file `animals-subset.csv`:

```bash
$ head -n 3 animals.csv > animals-subset.csv
$ tail -n 2 animals.csv >> animals-subset.csv
```

1.  The first three lines of `animals.csv`
2.  The last two lines of `animals.csv`
3.  The first three lines and the last two lines of `animals.csv`
4.  The second and third lines of `animals.csv`

## The pipe

- So that worked, but it relied on two intermediate text files (`lengths.txt` and `sorted-lengths.txt`). That is confusing.

- We can streamline the analysis by sending the results of one command directly into the input of another with the pipe: `|`

```bash
sort -n lengths.txt | head -n 1
```

## Chaining pipes

- In fact, we can **combine multiple commands with multiple pipes**. That way we don't need any intermediate files!

```bash
wc -l *.pdb | sort -n
wc -l *.pdb | sort -n | head -n 1
```

---

![](https://swcarpentry.github.io/shell-novice/fig/redirects-and-pipes.svg)

## Nelle’s Pipeline: Checking Files

- Nelle has run her samples through the assay machines and created 17 files in `north-pacific-gyre`

```bash
cd north-pacific-gyre
wc -l *.txt
```

## Nelle’s Pipeline: Checking Files

- Nelle checks to see if any files are much **shorter** than the others

```bash
wc -l *.txt | sort -n | head -n 5
```

## Nelle’s Pipeline: Checking Files

- Nelle checks to see if any files are much **longer** than the others

```bash
wc -l *.txt | sort -n | tail -n 5
```

```
 300 NENE02040B.txt
 300 NENE02040Z.txt
 300 NENE02043A.txt
 300 NENE02043B.txt
5040 total
```

- What's that file with a `Z`?

## Nelle’s Pipeline: Checking Files

- All of Nelle's samples should be marked `A` or `B`; by convention, her lab uses `Z` to indicate samples with missing information. To find others like it, she does this:

```
ls *Z.txt
```

- Remember this for future exercises: Nelle will need to select files with `NENE*A.txt` or `NENE*B.txt`

## Challenge: Removing Unneeded Files {.smaller}

Suppose you want to delete your processed data files, and only keep your raw files and processing script to save storage.

The raw files end in `.dat` and the processed files end in `.txt`.

**Which of the following would remove all the processed data files, and *only* the processed data files?**

1. `rm ?.txt`
2. `rm *.txt`
3. `rm * .txt`
4. `rm *.*`